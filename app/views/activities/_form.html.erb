<%= form_with(model: activity, scope: :activity, url: activities_path, local: true) do |form| %>
  <div class="card bg-base-200 shadow-lg">
    <div class="card-body">
      <div class="flex justify-between items-center mb-6">
        <h2 class="card-title">New <%= activity.class.display_name %></h2>
        <div class="flex gap-2">
          <%= form.submit "Submit", class: "btn btn-primary btn-sm" %>
          <%= link_to "Cancel", :back, class: "btn btn-secondary btn-outline btn-sm" %>
        </div>
      </div>

      <% if activity.errors.any? %>
        <div class="alert alert-error mb-4">
          <div>
            <h3 class="font-semibold"><%= pluralize(activity.errors.count, "error") %> prohibited this activity from being saved:</h3>
            <ul class="list-disc list-inside mt-2">
              <% activity.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        </div>
      <% end %>

      <div class="mb-6">
        <h3 class="text-base-content/70 font-semibold border-b border-base-400 pb-2 mb-4">Basic Information</h3>

        <%= form.hidden_field :type %>

        <div class="grid grid-cols-1 sm:grid-cols-12 gap-4 mb-4">
          <div class="sm:col-span-3">
            <%= form.label :data_config, data_config_type_label(activity), class: "label-text font-medium" %>
          </div>
          <div class="sm:col-span-9">
            <%= form.collection_select :data_config_id, DataConfig.for(Current.user, activity), :id, :display_name,
                                       { include_blank: "Select a #{data_config_type_label(activity)}" },
                                       class: "select select-bordered w-full" %>
          </div>
        </div>

        <% if activity.requires_files? %>
          <div class="grid grid-cols-1 sm:grid-cols-12 gap-4 mb-4">
            <div class="sm:col-span-3">
              <%= form.label :files, activity.requires_single_file? ? "File" : "Files", class: "label-text font-medium" %>
            </div>
            <div class="sm:col-span-9">
              <%= form.file_field :files,
                                  multiple: !activity.requires_single_file?,
                                  name: "activity[files][]",
                                  class: "file-input file-input-bordered w-full" %>
            </div>
          </div>
        <% end %>
      </div>

      <% if activity.requires_config_fields? %>
        <%= render "#{activity.class.display_name.parameterize(separator: "_")}_fields", form: form, activity: activity %>
      <% end %>

      <% if activity.requires_batch_config? %>
        <div class="mb-6">
          <h3 class="text-base-content/70 font-semibold border-b border-base-400 pb-2 mb-4">Batch config</h3>

          <%= render "batch_config_form", form: form, activity: activity %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>